{% extends "builder/base_site.html" %}
{% load i18n admin_static %}

{% block breadcrumbs %}
<ul class="breadcrumb">
<li><a href="{% url 'build_list' %}">{% trans 'Build list' %}</a> <span class="divider">/</span></li>
<li>{{ build.name }}</li>
</ul>
{% endblock %}

{% block content %}
<ul class="object-tools pull-right">
    <li>
        {% if build.has_components %}
        <a href="{% url "build_download_config_file" build.slug %}" class="btn">
        {% else %}
        <a href="javascript:void(0)" title="{% trans "No component available for download." %}" class="btn disabled">
        {% endif %}
            {% trans "Download config" %}
        </a>
    </li>
</ul>
<div id="buildDetailContainer" class="container-fluid">
    <fieldset>
        <legend>{% trans "Config" %}</legend>
        <div class="row-fluid">
            <div class="span3">{% trans "Baseline" %}</div>
            <div class="span9">{{ build.baseline }}</div>
        </div>
        <div class="row-fluid">
            <div class="span3">{% trans "Product" %}</div>
            <div class="span9">{{ build.product }}</div>
        </div>
    </fieldset>
    <fieldset>
        <legend>{% trans "Components" %}</legend>
        {% for component in build.component.all %}
        <div class="row-fluid">
            <div class="span3">{{ component.type }}</div>
            <div class="span9">{{ component}}</div>
        </div>
        {% empty %}
        <div class="row-fluid text-center">
            {% trans "No component selected" %}
        </div>
        {% endfor %}
    </fieldset>
    <fieldset>
        <legend>{% trans "Processes" %}</legend>
        {% for process in build.process_set.all %}
        <div class="row-fluid">
            <div class="span2">{{ process.type }}</div>
            <div class="span2">{{ process.status }}</div>
            <div class="span3">
                <div class="progress progress-striped active">
                    <div class="bar" style="width: {{ process.progress }}%;"></div>
                </div>
            </div>
            <div class="span2">{{ process.message|default:""|safe }}</div>
        </div>
        {% empty %}
        <div class="row-fluid text-center">
            {% trans "No url was found yet." %}
        </div>
        {% endfor %}
</div>
{% endblock %}

{% block js_footer %}
<script type="text/javascript" charset="utf-8">
var container = $('#buildDetailContainer');
var updateProcess = function() {
    $.get('{% url "build_detail_content" build.slug %}', {}, function(html) {
        container.html(html);
    });
}
setInterval(updateProcess, 1000);
</script>
{% endblock %}
